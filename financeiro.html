<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Financeiro • Água de Lastro • MAV-IT</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="page-wrapper">
    <aside class="sidebar">
      <div class="brand"><div class="logoDot"></div><div class="brandText">MAV‑IT • BW COMP</div></div>
      <nav class="sidebar-nav">
        <a href="dashboard.html" class="nav-item">Novo Atestado</a>
        <a href="minhas-requisicoes.html" class="nav-item">Minhas Requisições</a>
        <a href="meus-atestados.html" class="nav-item">Meus Atestados</a>
        <a href="arquivados.html" class="nav-item">Arquivados</a>
        <a href="cadastro-usuarios.html" class="nav-item">Cadastro de Usuários</a>
        <a href="financeiro.html" class="nav-item active">Financeiro</a>
        <a href="suporte.html" class="nav-item">Suporte Técnico</a>
      </nav>
      <div class="sidebar-footer">
        <a href="index.html" onclick="localStorage.removeItem('usuarioLogado')">Sair</a>
      </div>
    </aside>
    <main class="main-content">
      <div class="container">
        <div class="card">
          <h2 class="section-title">Relatório Financeiro</h2>
          <div class="sub">Listagem de atestados finalizados para faturamento.</div>
          <table class="table" id="tb_list">
            <thead><tr><th>Ação</th><th>Porto</th><th>Tipo</th><th>Declaração</th><th>IMO</th><th>Status</th><th>Link</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="card" style="margin-top: 18px;">
          <h2 class="section-title">Dados Cadastrais para Faturamento</h2>
          <div class="sub">Cadastre ou atualize os dados da empresa contratante para cobrança.</div>
          
          <div class="grid cols-2">
            <div class="field-row"><div class="lab">Nome da Empresa</div><input class="input" id="f_nome_empresa"></div>
            <div class="field-row"><div class="lab">CNPJ</div><input class="input" id="f_cnpj"></div>
            <div class="field-row"><div class="lab">E-mail de Cobrança</div><input class="input" type="email" id="f_email"></div>
            <div class="field-row"><div class="lab">Telefone</div><input class="input" type="tel" id="f_telefone"></div>
            <div class="field-row"><div class="lab">Endereço</div><input class="input" id="f_endereco"></div>
            <div class="field-row"><div class="lab">Cidade / Estado</div><input class="input" id="f_cidade_estado"></div>
          </div>
          
          <h3 class="section-title" style="margin-top: 20px; border-top: 1px solid #eef2ff; padding-top: 15px;">Dados Bancários</h3>
          <div class="grid cols-3">
             <div class="field-row"><div class="lab">Banco</div><input class="input" id="f_banco"></div>
             <div class="field-row"><div class="lab">Agência</div><input class="input" id="f_agencia"></div>
             <div class="field-row"><div class="lab">Conta Corrente</div><input class="input" id="f_conta"></div>
          </div>

          <div style="margin-top: 20px;">
            <button class="btn" onclick="saveFinancialData()">Salvar Dados Cadastrais</button>
          </div>
        </div>
      </div>
    </main>
  </div>
<script>
// --- INÍCIO DO BLOCO DE UTILIDADES ---
if(!localStorage.getItem('usuarioLogado')) window.location.href='index.html';
function currentUser(){ return localStorage.getItem('usuarioLogado')||'anon'; }
function getDb(){
  const key = 'mav_it_data_' + currentUser();
  const defaults = { requisicoes: [], atestados: [], arquivados: [], usuarios: [], faturamento: {} };
  try {
    const db = JSON.parse(localStorage.getItem(key));
    if (!db.faturamento) {
      db.faturamento = {};
    }
    return db || defaults;
  } catch(e) { return defaults; }
}
function saveDb(db){
  const key = 'mav_it_data_' + currentUser();
  localStorage.setItem(key, JSON.stringify(db));
}
// --- FIM DO BLOCO DE UTILIDADES ---

// --- LÓGICA PARA O RELATÓRIO (PARTE DE CIMA) ---
function renderTable(){
  const db = getDb();
  const tbody = document.querySelector('#tb_list tbody');
  tbody.innerHTML = '';

  if(db.atestados.length === 0){
    tbody.innerHTML = '<tr><td colspan="7" class="small">Nenhum item para faturamento.</td></tr>';
    return;
  }

  db.atestados.forEach((item, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="actions"><button class="btn small-btn" disabled>Editar</button></td>
      <td>${item.port || '-'}</td>
      <td>${item.tipo || '-'}</td>
      <td>${item.ship || '-'}</td>
      <td>${item.imo || '-'}</td>
      <td><span class="badge ok">Faturado</span></td>
      <td><a href="#">Gerar Link</a></td>
    `;
    tbody.appendChild(tr);
  });
}

// --- LÓGICA PARA O FORMULÁRIO (PARTE DE BAIXO) ---
function saveFinancialData() {
  const data = {
    nomeEmpresa: document.getElementById('f_nome_empresa').value,
    cnpj: document.getElementById('f_cnpj').value,
    email: document.getElementById('f_email').value,
    telefone: document.getElementById('f_telefone').value,
    endereco: document.getElementById('f_endereco').value,
    cidadeEstado: document.getElementById('f_cidade_estado').value,
    banco: document.getElementById('f_banco').value,
    agencia: document.getElementById('f_agencia').value,
    conta: document.getElementById('f_conta').value,
  };

  const db = getDb();
  db.faturamento = data;
  saveDb(db);

  alert('Dados de faturamento salvos com sucesso!');
}

function loadFinancialData() {
  const db = getDb();
  const data = db.faturamento || {};

  document.getElementById('f_nome_empresa').value = data.nomeEmpresa || '';
  document.getElementById('f_cnpj').value = data.cnpj || '';
  document.getElementById('f_email').value = data.email || '';
  document.getElementById('f_telefone').value = data.telefone || '';
  document.getElementById('f_endereco').value = data.endereco || '';
  document.getElementById('f_cidade_estado').value = data.cidadeEstado || '';
  document.getElementById('f_banco').value = data.banco || '';
  document.getElementById('f_agencia').value = data.agencia || '';
  document.getElementById('f_conta').value = data.conta || '';
}

// --- CARREGA AMBAS AS SEÇÕES QUANDO A PÁGINA É ABERTA ---
renderTable();
loadFinancialData();
</script>
</body>
</html>
